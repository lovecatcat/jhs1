<template>
  <div class="insurance">
    <app-dropdown :label="plan_name ? plan_name : '险种信息'" :up="showAll" :func="()=>{showAll = !showAll}">
      <app-select label="公司品牌">
        <select v-model='sc_id' @change="companyChanged">
          <option selected disabled value=''>请选择</option>
          <option v-for="item,index in sc_name" :value="index">{{item}}</option>
        </select>
      </app-select>
      <app-select label="险种">
        <select v-model='insurance.safe_id' @change="insChanged">
          <option disabled value=''>请选择</option>
          <option v-for="item,index in insInfo[sc_id]" :key="index" :value="item.safe_id">{{item.name}} </option>
        </select>
      </app-select>
      <app-select label="保险期间" :readonly="mainSyAttr != null && mainSyAttr.length === 1">
        <select v-model.number='insurance.safe_year'
                :disabled="mainSyAttr != null && mainSyAttr.length === 1"
                @change="resetFee">
          <option disabled value=''>请选择</option>
          <option v-for="(item,index) in mainSyAttr" :value="item.safe_year" :key="index">
            {{item.safe_year | safeYearFilter}}
          </option>
        </select>
      </app-select>
      <app-select label="缴费年限" :readonly="mainPyAttr != null && mainPyAttr.length === 1">
        <select v-model.number='insurance.pay_year'
                :disabled="mainPyAttr != null && mainPyAttr.length === 1"
                @change="resetFee">
          <option selected disabled value=''>请选择</option>
          <option v-for="(item,index) in mainPyAttr" :value="item.pay_year" :key="index">
            {{item.pay_year === '1' ? '趸交' : item.pay_year + '年交'}}
          </option>
        </select>
      </app-select>
      <template v-if="insurance.safe_id">
        <!-- 输入保额算保费 -->
        <template v-if="isBaseMoney">
          <app-select label="计划类型" v-if="prospectus_types.length > 0">
            <select v-model.number="prospectus_type" @change="resetFee">
              <option disabled value=''>请选择</option>
              <option v-for="item in prospectus_types" :value="item.value">{{item.name}}</option>
            </select>
          </app-select>
          <app-select label="领取年龄" v-if="insurance.safe_id === '205'">
            <select v-model.number="flag['205']" @change="resetFee">
              <option disabled value='0'>请选择</option>
              <option value="60">60岁</option>
              <option value="65">65岁</option>
              <option value="70">70岁</option>
              <option value="75">75岁</option>
            </select>
          </app-select>
          <app-input label="基本保额"
                     v-if="insurance.safe_id !== '292'"
                     v-show="insurance.safe_id !== '309' && insurance.safe_id !== '280'">
            <input slot="input"
                   type="number"
                   v-model.number.lazy="insurance.money"
                   placeholder="请填写基本保险金额（元）"
                   @change="resetFee">
            <div slot="icon"
                 @click="insurance.money = ''"
                 v-show="insurance.money !== ''"
                 class="am-list-clear">
              <i class="am-icon-clear am-icon"></i>
            </div>
          </app-input>
          <template v-else>
            <app-select label="投保份数">
              <select v-model.number="insurance.money" @change="resetFee">
                <option disabled value="0">请选择份数</option>
                h
                <option :value="n" v-for="n in 4">{{n}}</option>
              </select>
            </app-select>
            <app-input label="基本保额">
              <div slot="input">{{insurance.money * 50000}}</div>
            </app-input>
          </template>
          <app-input label="年缴保费">
            <input slot="input" readonly v-model.number.lazy="insurance.period_money" type="number"
                   placeholder="年缴保费（元）">
            <div slot="button" class="am-list-button">
              <button type="button" @click="calMoney()">点击计算</button>
            </div>
          </app-input>
        </template>
        <!-- 输入保额算保费 -->
        <!-- 泰康乐行天下 -->
        <template v-else-if="isBaseMoney">
          <app-input label="基本保额">
            <input slot="input" readonly v-model.number.lazy="insurance.money" type="number" placeholder="完善附加险再计算">
          </app-input>
          <app-input label="年缴保费">
            <input slot="input" readonly v-model.number.lazy="insurance.period_money" type="number"
                   placeholder="完善附加险再计算">
            <div slot="button" class="am-list-button">
              <button type="button" @click="calMoney()">点击计算</button>
            </div>
          </app-input>
        </template>
        <!-- 泰康乐行天下 -->
        <!-- 输入保费算保额 -->
        <template v-else>
          <app-select label="计划类型" v-if="prospectus_types.length > 0">
            <select v-model.number="prospectus_type" v-if="prospectus_types" @change="resetFee">
              <option disabled value=''>请选择</option>
              <option v-for="item in prospectus_types" :value="item.value">{{item.name}}</option>
            </select>
          </app-select>
          <app-select label="领取年龄" v-if="insurance.safe_id === '352'">
            <!-- 中国人保尊赢人生 -->
            <select v-model.number="flag['352']" @change="resetFee">
              <option disabled value='0'>请选择</option>
              <option value="60">60岁</option>
              <option value="80">80岁</option>
            </select>
          </app-select>
          <app-input label="年缴保费">
            <input slot="input" v-model.number.lazy="insurance.period_money" type="number" placeholder="请填写年缴保费（元）"
                   @change="resetFee">
            <div slot="icon" v-show="insurance.period_money != ''" class="am-list-clear"><i
              class="am-icon-clear am-icon" @click="insurance.period_money = ''"></i></div>
          </app-input>
          <app-input label="基本保额">
            <input slot="input" readonly v-model.number.lazy="insurance.money" type="number"
                   placeholder="基本保险金额（元）">
            <div slot="button" class="am-list-button">
              <button type="button" @click="calMoney()">点击计算</button>
            </div>
          </app-input>
        </template>
        <!-- 输入保费算保额 -->
      </template>
    </app-dropdown>
    <app-dropdown :ref="'appl_'+item.safe_id" v-show="showAll" v-for="item,index in Addons" :key="index"
                  :id="'fj'+item.safe_id" up="up">
      <template slot="header">
        <div class="am-ft-md"> {{item.name}}</div>
        <div class="am-list-extra" style="min-width:.44rem">投保&nbsp;</div>
        <div class="am-switch">
          <input type="checkbox"
                 @change="chAddonState(item.safe_id)"
                 v-model="addonsSelected[item.safe_id]"
                 class="am-switch-checkbox" :id="'appl_'+item.safe_id">
          <label class="am-switch-label" :for="'appl_'+item.safe_id">
            <div class="am-switch-inner"></div>
            <div class="am-switch-switch"></div>
          </label>
        </div>
      </template>
      <!-- 附加品质生活年金保险 -->
      <template v-if="item.safe_id==='354'">
        <app-input label="年缴保费">
          <input slot="input"
                 v-model.number="cache.derate_money354"
                 type="number"
                 placeholder="基本保险金额（元）"
                 @change="chAddonState(item.safe_id)">
          <div slot="icon" v-show="cache.derate_money354 !== ''" class="am-list-clear"><i
            class="am-icon-clear am-icon" @click="cache.derate_money354 = ''"></i></div>
        </app-input>
        <div class="am-notice" role="alert">
          <div class="am-notice-content">年缴保费为1000元整数倍，可为0</div>
        </div>
      </template>
      <!-- 附加品质生活年金保险 -->
      <!-- 附加金账户年金保险 -->
      <template v-if="item.safe_id==='349'">
        <app-input label="年缴保费">
          <input slot="input" v-model.number="cache.derate_money349" type="number" placeholder="基本保险金额（元）"
                 @change="chAddonState(item.safe_id)">
          <div slot="icon" v-show="cache.derate_money349 !== ''" class="am-list-clear"><i
            class="am-icon-clear am-icon" @click="cache.derate_money349 = ''"></i></div>
        </app-input>
        <div class="am-notice" role="alert">
          <div class="am-notice-content">年缴保费为1000元整数倍，可为0</div>
        </div>
      </template>
      <!-- 附加金账户年金保险 -->
      <!-- 附加乐行天下意外住院津贴 -->
      <template v-if="item.safe_id === '333'">
        <div class="am-list-item">
          <div class="am-list-content">保障金额</div>
          <div class="am-ft-black">100元/日</div>
        </div>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">保障期间</div>
            <div class="am-ft-black">{{mainSafeYear}}年</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费期间</div>
            <div class="am-ft-black">{{mainPayYear}}年</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费</div>
            <div class="am-ft-orange" v-model.number="cache.pay_money333">{{addonRes[item.safe_id]['年缴保费']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加乐行天下意外住院津贴  -->
      <!-- 附加乐行天下意外伤害 -->
      <template v-if="item.safe_id === '332'">
        <app-select label="保险金额">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择</option>
            <option value="100000">100000</option>
            <option value="200000">200000</option>
            <option value="300000">300000</option>
          </select>
        </app-select>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">保障期间</div>
            <div class="am-ft-black">{{mainSafeYear}}年</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费期间</div>
            <div class="am-ft-black">{{mainPayYear}}年</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费</div>
            <div class="am-ft-orange" v-model.number="cache.pay_money332">{{addonRes[item.safe_id]['年缴保费']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加乐行天下意外伤害  -->
      <!-- 附加恒祥 -->
      <template v-if="item.safe_id === '295'">
        <app-input label="保险金额">
          <input slot="input" v-model.number="cache.base_money295" type="number" placeholder="保险金额(元)"
                 @change="addonRes[item.safe_id]=null,addonsSelected[item.safe_id]=false">
          <div slot="icon" v-show="cache.base_money295 != ''" class="am-list-clear"><i class="am-icon-clear am-icon"
                                                                                       @click="cache.base_money295 = ''"></i>
          </div>
        </app-input>
        <div class="am-list-footer"><span class='am-ft-orange'>最低50元,10的整数倍。累计不超过100元/天</span>
        </div>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">保障期间</div>
            <div class="am-ft-black">终身</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费期间</div>
            <div class="am-ft-black">趸缴</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">保险金额</div>
            <div class="am-ft-orange">{{cache.base_money295}}</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加恒祥 -->
      <!-- 附加恒顺 -->
      <template v-else-if="item.safe_id === '294'">
        <app-select label="保险金额">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择</option>
            <option value="2000">2000</option>
            <option value="3000">3000</option>
            <option value="4000">4000</option>
            <option value="5000">5000</option>
            <option value="6000">6000</option>
            <option value="7000">7000</option>
            <option value="8000">8000</option>
            <option value="9000">9000</option>
            <option value="10000">10000</option>
            <option value="15000">15000</option>
            <option value="20000">20000</option>
            <option value="52000">5类职业2000</option>
            <option value="53000">5类职业3000</option>
            <option value="54000">5类职业4000</option>
            <option value="55000">5类职业5000</option>
            <option value="56000">5类职业6000</option>
            <option value="57000">5类职业7000</option>
            <option value="58000">5类职业8000</option>
            <option value="59000">5类职业9000</option>
            <option value="510000">5类职业10000</option>
            <option value="515000">5类职业15000</option>
            <option value="520000">5类职业20000</option>
            <option value="62000">6类职业2000</option>
            <option value="63000">6类职业3000</option>
            <option value="64000">6类职业4000</option>
            <option value="65000">6类职业5000</option>
            <option value="66000">6类职业6000</option>
            <option value="67000">6类职业7000</option>
            <option value="68000">6类职业8000</option>
            <option value="69000">6类职业9000</option>
            <option value="610000">6类职业10000</option>
            <option value="615000">6类职业15000</option>
            <option value="620000">6类职业20000</option>
          </select>
        </app-select>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">保障期间</div>
            <div class="am-ft-black">终身</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费期间</div>
            <div class="am-ft-black">趸缴</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">保险金额</div>
            <div class="am-ft-orange">
              {{flag[item.safe_id] > 50000 ? flag[item.safe_id].toString().substr(1) : flag[item.safe_id]}}
            </div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加恒顺 -->
      <!-- 金财人生终身年金保险D款 -->
      <template v-else-if="item.safe_id==='291'">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">终身</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">趸交</div>
        </div>
        <app-input label="年缴保费">
          <input slot="input" v-model.number="cache.derate_money291" type="number" placeholder="基本保险金额（元）"
                 @change="chAddonState(item.safe_id)">
          <div slot="icon" v-show="cache.derate_money291 !== ''" class="am-list-clear"><i
            class="am-icon-clear am-icon" @click="cache.derate_money291 = ''"></i></div>
        </app-input>
        <div class="am-notice" role="alert">
          <div class="am-notice-content">年缴保费为1000元整数倍，可为0</div>
        </div>
      </template>
      <!-- 金财人生终身年金保险D款 -->
      <!-- 附加尊享安康费用补偿医疗保险 -->
      <template v-else-if="item.safe_id === '293'">
        <app-select label="保险金额">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择</option>
            <option value="150">有社保50万</option>
            <option value="250">无社保50万</option>
          </select>
        </app-select>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">保障期间</div>
            <div class="am-ft-black">1年</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费期间</div>
            <div class="am-ft-black">趸缴</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">保险金额</div>
            <div class="am-ft-orange">500000</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加尊享安康费用补偿医疗保险 -->
      <!-- 附加投保人豁免保险费重大疾病保险（2017 版） -->
      <template v-else-if="(item.safe_id==='289') && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">终身</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{mainPayYear - 1}}年交</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-orange">{{insurance.period_money}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加投保人豁免保险费重大疾病保险（2017 版） -->
      <!-- 附加豁免保险费定期寿险 -->
      <template v-else-if="(item.safe_id==='285' || item.safe_id==='284') && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">{{mainPayYear - 1}}年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{mainPayYear - 1}}年交</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-orange">{{insurance.period_money}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加豁免保险费定期寿险 -->
      <!-- 附加投保人保费豁免重大疾病保险 -->
      <template v-else-if="item.safe_id === '281' && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">{{mainPayYear}}年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{mainPayYear}}年交</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-orange">{{insurance.period_money}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加投保人保费豁免重大疾病保险 -->
      <!-- 附加住院费用医疗（社保和非社保型）235-236 -->
      <template v-else-if="(item.safe_id === '235' || item.safe_id === '236' || item.safe_id === '237')">
        <app-select label="保险金额">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择</option>
            <option value="1" v-if="(insurance.period_money > 1000 && insurance.period_money <= 1499)">1份</option>
            <option :value="n" v-else-if="(insurance.period_money > 1500 && insurance.period_money <= 2999)"
                    v-for="n in 2">{{n}}份
            </option>
            <option :value="n" v-else-if="(insurance.period_money > 3000 && insurance.period_money <= 3999)"
                    v-for="n in 3">{{n}}份
            </option>
            <option :value="n" v-else-if="(insurance.period_money > 4000 && insurance.period_money <= 4999)"
                    v-for="n in 4">{{n}}份
            </option>
            <option :value="n" v-else-if="(insurance.period_money > 4000 && item.safe_id === '237')" v-for="n in 4">{{n}}份</option>
            <option :value="n" v-else-if="(insurance.period_money > 5000 && insurance.period_money <= 5999)"
                    v-for="n in 5">{{n}}份
            </option>
            <option :value="n" v-else-if="insurance.period_money > 6000" v-for="n in 6">{{n}}份</option>
          </select>
        </app-select>
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">1年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">趸交</div>
        </div>
        <div class="am-list-item" v-if="addonRes[item.safe_id]">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加住院费用医疗（社保和非社保型）235-236 -->
      <!-- 华宝安康医疗保险 -->
      <template v-else-if="item.safe_id === '273'">
        <app-select label="选择计划">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择计划</option>
            <option value='1'>愈安</option>
            <option value='3'>愈佳</option>
          </select>
        </app-select>
        <div class="am-list-item" v-for="(value,key) in addonRes[item.safe_id]" v-if="key !== '社保外特殊病房床位费及膳食费'">
          <div class="am-list-content">{{key}}</div>
          <div class="am-ft-orange">{{value}}</div>
        </div>
      </template>
      <!-- 华宝安康医疗保险 -->
      <!-- 附加住院津贴医疗保险 -->
      <template v-else-if="item.safe_id === '196' && addonRes[item.safe_id]">
        <div class="am-list-item" v-for="(value,key) in addonRes[item.safe_id]">
          <div class="am-list-content">{{key}}</div>
          <div class="am-ft-orange">{{value}}</div>
        </div>
      </template>
      <!-- 附加住院津贴医疗保险 -->
      <!-- 附加御立方三号重大疾病保险 -->
      <template v-else-if="item.safe_id === '177' && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">轻症保险金</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['轻症保险金']}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">重疾保险金</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['重疾保险金']}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">现金价值</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['现金价值']}}</div>
        </div>
      </template>
      <!-- 附加御立方三号重大疾病保险 -->
      <!-- 附加乐无忧住院医疗保险 -->
      <template v-else-if="item.safe_id === '175'">
        <app-select label="保险计划">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择计划</option>
            <option value='1'>计划一(基本保额：1万元)</option>
            <option value='2'>计划二(基本保额：2万元)</option>
            <option value='3'>计划三(基本保额：3.5万元)</option>
            <option value='4'>计划四(基本保额：5万元)</option>
          </select>
        </app-select>
        <template v-if="addonRes[item.safe_id]">
          <div class="am-list-item">
            <div class="am-list-content">住院医疗保险金-计划{{flag[item.safe_id]}}(元)</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['住院医疗保险金-计划' + flag[item.safe_id] + '(元)']}}</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">自费用药费用保险金-计划{{flag[item.safe_id]}}(元) </div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['自费用药费用保险金-计划' + flag[item.safe_id] + '(元)']}}</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">保障期间(年)</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['保障期间(年)']}}</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">缴费年间(年)</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['缴费年间(年)']}}</div>
          </div>
          <div class="am-list-item">
            <div class="am-list-content">年缴保费(元)</div>
            <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费(元)']}}</div>
          </div>
        </template>
      </template>
      <!-- 附加乐无忧住院医疗保险 -->
      <!-- 附加综合意外伤害保险 -->
      <template v-else-if="item.safe_id === '148'">
        <app-input label="保险金额">
          <input slot="input" v-model.number="cache.base_money148" type="number" placeholder="基本保险金额（元）"
                 @change="addonRes[item.safe_id]=null,addonsSelected[item.safe_id]=false">
          <div slot="icon" v-show="cache.base_money148 != ''" class="am-list-clear"><i class="am-icon-clear am-icon"
                                                                                       @click="cache.base_money148 = ''"></i>
          </div>
          <span slot="button" class="am-ft-orange am-ft-sm">(5万~300万)</span>
        </app-input>
        <app-select label="职业分类">
          <select v-model.number="flag[item.safe_id]"
                  @change="addonRes[item.safe_id]=null,addonsSelected[item.safe_id]=false">
            <option disabled value='0'>请选择职业分类</option>
            <option :value="item" v-for="item in 4">{{item}}类</option>
          </select>
        </app-select>
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">1年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">趸交</div>
        </div>
        <div class="am-list-item" v-if="addonRes[item.safe_id]">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加综合意外伤害保险 -->
      <!-- 附加住院费用医疗保险 -->
      <template v-else-if="item.safe_id === '147'">
        <app-input label="投保份数">
          <input slot="input" v-model.number="cache.quota147" type="number" placeholder="请输入投保份数"
                 @change="flagChanged(item.safe_id)">
          <div slot="icon" v-show="cache.quota147 != ''" class="am-list-clear"><i class="am-icon-clear am-icon"
                                                                                  @click="cache.quota147 = ''"></i>
          </div>
          <span slot="button"
                class="am-ft-orange am-ft-sm">({{insurance.period_money > 3000 ? '2-30' : '2-10'}}份)</span>
        </app-input>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-black">{{flag[item.safe_id]}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">1年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">趸交</div>
        </div>
        <div class="am-list-item" v-if="addonRes[item.safe_id]">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加住院费用医疗保险 -->
      <!-- 附加意外伤害医疗B -->
      <template v-else-if="item.safe_id === '146'">
        <app-select label="保险金额">
          <select v-model.number="flag[item.safe_id]" @change="flagChanged(item.safe_id)">
            <option disabled value='0'>请选择金额</option>
            <option value="2000">2000元</option>
            <option value="3000">3000元</option>
            <option value="4000">4000元</option>
            <option value="5000">5000元</option>
            <option value="6000">6000元</option>
            <option value="7000">7000元</option>
            <option value="8000">8000元</option>
            <option value="9000">9000元</option>
            <option value="10000">10000元</option>
            <option value="15000">15000元</option>
            <option value="20000">20000元</option>
          </select>
        </app-select>
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">1年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">趸交</div>
        </div>
        <div class="am-list-item" v-if="addonRes[item.safe_id]">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加意外伤害医疗B -->
      <!-- 附加乐相伴豁免保险费重大疾病保险 -->
      <template v-else-if="item.safe_id === '131' && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">{{mainPayYear > 1 ? mainPayYear - 1 : mainPayYear}}年</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{mainPayYear > 1 ? (mainPayYear - 1) + '年交' : '趸交'}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-orange">{{insurance.period_money}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费(元)']}}</div>
        </div>
      </template>
      <!-- 附加乐相伴豁免保险费重大疾病保险 -->
      <!-- 附加如意尊享住院费用B款医疗保险 -->
      <template v-else-if="item.safe_id === '121' && addonRes[item.safe_id]">
        <div class="am-list-item" v-for="(value,key) in addonRes[item.safe_id]">
          <div class="am-list-content">{{key}}</div>
          <div class="am-ft-orange">{{value}}</div>
        </div>
      </template>
      <!-- 附加如意尊享住院费用B款医疗保险 -->
      <!-- 国华附加年金保险 -->
      <template v-else-if="item.safe_id === '94' && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">至85岁</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{mainPayYear}}年交</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">保险金额</div>
          <div class="am-ft-orange">{{insurance.period_money * mainPayYear}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 国华附加年金保险 -->
      <!-- 附加豁免保险费重疾保险 -->
      <template v-else-if="item.safe_id === '86' && addonRes[item.safe_id]">
        <div class="am-list-item">
          <div class="am-list-content">保障期间</div>
          <div class="am-ft-black">{{(mainPayYear - 1) + '年'}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">缴费期间</div>
          <div class="am-ft-black">{{(mainPayYear - 1) + '年交'}}</div>
        </div>
        <div class="am-list-item">
          <div class="am-list-content">年缴保费</div>
          <div class="am-ft-orange">{{addonRes[item.safe_id]['年缴保费']}}</div>
        </div>
      </template>
      <!-- 附加豁免保险费重疾保险 -->
    </app-dropdown>
    <!--    <div class="am-button-group">
          <button type="button" class="am-button save" @click="saveIns"><i
            class="iconfont icon-baocun"></i> 保存
          </button>
        </div>-->
  </div>
</template>
<script>
  import utils from '../widgets/utils'
  import qs from 'qs'
  import {
    mapState,
    mapGetters
  } from 'vuex'

  const calMoneyIns = ['74', '182', '290', '352', '360'] // 算保额的主险

  const mustSelected = ['291', '177', '11', '333', '332', '349', '354'] // 必须附加的附加险

  export default {
    name: 'insurance',
    props: {
      index: Number,
      edit: Object
    },
    data () {
      return {
        uploading: false, // 是否正在提交数据
        showAll: true, // 展开
        plan_name: '',
        sc_id: '',
        sc_name: {
          '7': '泰康人寿',
          '8': '国华人寿',
          '10': '工银安盛',
          '14': '中国平安',
          '19': '信泰人寿',
          '36': '中英人寿',
          '42': '恒大人寿',
          '43': '安联财险'
        },
        mainInsurance: [],
        mainSyAttr: [],
        mainPyAttr: [],
        isBaseMoney: true, // 输入保额
        prospectus_types: [], // 计划类型
        prospectus_type: '', // 选择的计划类型
        flag: {}, // 试算特殊参数
        cache: { // 数据缓存
          base_money148: '',
          base_money295: '',
          quota147: '',
          derate_money291: '',
          derate_money349: '',
          derate_money354: '',
          pay_money332: '',
          pay_money333: ''
        },
        insurance: { // 主险投保信息
          safe_id: '',
          safe_year: '',
          pay_year: '',
          money: '', // 基本保险金额
          period_money: '' // 年交保费
        },
        mainInsData: {}, // 主险提交信息
        mainPayYear: '', // 主险缴费期间
        mainSafeYear: '', // 主险保障期间
        samePerson: false,
        addonInsData: {}, // 附加险提交信息
        addonRes: {}, // 主险下附加险信息
        addonsSelected: {} // 选择的附加险
      }
    },
    watch: {
      insurance: {
        handler (val) {
          this.saveIns()
        },
        deep: true
      },
      mainInsData: {
        handler (val) {
          this.saveIns()
        },
        deep: true
      },
      addonInsData: {
        handler (val) {
          this.saveIns()
        },
        deep: true
      }
    },
    computed: {
      ...mapState([
        'appl',
        'admin_id',
        'insInfo',
        'insList'
      ]),
      ...mapGetters([
        'assu',
        'ins'
      ]),
      Addons () {
        if (!this.insurance.safe_id) return {}
        return this.insInfo[this.sc_id][this.insurance.safe_id].child
      }
    },
    methods: {
      companyChanged () {
        console.info('companyChanged')
        if (!this.insInfo[this.sc_id]) {
          this.$store.dispatch('SET_INSINFO', {
            sc_id: this.sc_id,
            cb: this.errorCb
          })
        }
      },
      insChanged () {
        console.info('insChanged')
        let safeId = this.insurance.safe_id
        if (!safeId) return

        let mainIns = this.insInfo[this.sc_id][safeId]
        this.mainInsurance = mainIns
        this.plan_name = mainIns.name

        // 保险期间
        let mainSyAttr = utils.unique(mainIns.attr, 'safe_year') // 去重
        mainSyAttr = mainSyAttr.sort((a, b) => a.safe_year - b.safe_year) // 排序
        this.mainSyAttr = mainSyAttr

        if (mainSyAttr.length === 1) {
          this.insurance.safe_year = mainSyAttr[0].safe_year
        } else {
          this.insurance.safe_year = ''
        }

        // 缴费年限
        let mainPyAttr = utils.unique(mainIns.attr, 'pay_year') // 去重
        mainPyAttr = mainPyAttr.sort((a, b) => a.pay_year - b.pay_year) // 排序
        this.mainPyAttr = mainPyAttr

        if (mainPyAttr.length === 1) {
          this.insurance.pay_year = mainPyAttr[0].pay_year
        } else {
          this.insurance.pay_year = ''
        }

        this.isBaseMoney = calMoneyIns.indexOf(safeId) === -1

        // 计划类型
        switch (safeId) {
          case '74':
            this.prospectus_types = [{
              value: 'educate',
              name: '领取版'
            }, {
              value: 'asset',
              name: '财富传承'
            }]
            break
          case '172':
            this.prospectus_types = [{
              value: 'educate',
              name: '领取版'
            }, {
              value: 'asset',
              name: '财富传承'
            }]
            break
          case '280':
            this.prospectus_types = [{
              value: '100',
              name: '有社保100万'
            }, {
              value: '300',
              name: '有社保300万'
            }, {
              value: '1100',
              name: '无社保100万'
            }, {
              value: '1300',
              name: '无社保300万'
            }]
            break
          case '309':
            this.prospectus_types = [{
              value: '1',
              name: '计划一'
            }, {
              value: '2',
              name: '计划二'
            }, {
              value: '3',
              name: '计划三'
            }]
            break
          default:
            this.prospectus_types = []
            break
        }

        // 保费、保额
        if (safeId === '292') {
          this.insurance.money = 0
        } else if (safeId === '280' || safeId === '309') { // 平安e生保，安联无忧
          this.insurance.money = 1
        } else {
          this.insurance.money = ''
        }
        this.insurance.period_money = ''
      },
      resetFee () {
        console.info('resetFee')
        this.isBaseMoney ? this.insurance.period_money = '' : this.insurance.money = ''
        this.resetAddon()
      },

      calMoney (isAdd) {
        let safeId = isAdd || this.insurance.safe_id
        console.info('calMoney ', isAdd ? '附加险, ID:' + safeId : '主险, ID:' + safeId)

        if (this.uploading) {
          this.$toast.open('请勿连续点击！')
          return false
        }
        this.uploading = true
        setTimeout(() => {
          this.uploading = false
        }, 1000)

        this.mainPayYear = this.insurance.pay_year
        this.mainSafeYear = this.insurance.safe_year

        if (!this.checkForm()) { // ------------------------------------主要信息
          return false
        }
        if (isAdd) {
          if (!this.checkExtraAge(safeId)) { // -------------------------附加险投保年龄
            return false
          }
        } else {
          if (!this.checkMainAge(safeId)) { // -------------------------投保年龄
            return false
          } else if (!this.checkMainMoney(safeId)) { // ----------------保额/保费
            return false
          }
        }

        let data = {
          admin_id: this.admin_id,

          applicant: this.appl.name,
          appl_sex: this.appl.sex ? 1 : 2,
          appl_age: this.appl.age,

          assured: this.assu.name,
          assu_sex: this.assu.sex ? 1 : 2,
          assu_age: this.assu.age,

          safe_year: this.insurance.safe_year,
          pay_year: this.insurance.pay_year,

          warranty_year: 1,
          genre: safeId,
          fj: !!isAdd,
          is_save: 0,
          derate_money: 0,
          need_packet: 0
        }
        // 添加特殊参数
        let filterSafeid = ['74', '182', '290']
        if (filterSafeid.indexOf(safeId) > -1) {
          data = Object.assign(data, {
            assume_rate: '0',
            sa_one: '0',
            fa_one: '0',
            money_one: '0',
            sa_two: '0',
            fa_two: '0',
            money_two: '0',
            sa_three: '0',
            fa_three: '0',
            money_three: '0',
            sa_four: '0',
            fa_four: '0',
            money_four: '0',
            sa_five: '0',
            fa_five: '0',
            money_five: '0',
            sa_six: '0',
            fa_six: '0',
            money_six: '0',
            sa_seven: '0',
            fa_seven: '0',
            money_seven: '0',
            sa_eight: '0',
            fa_eight: '0',
            money_eight: '0',
            sa_night: '0',
            fa_night: '0',
            money_night: '0',
            sa_ten: '0',
            fa_ten: '0',
            money_ten: '0'
          })
        }
        // 计划书类型
        if (this.prospectus_types.length > 0) {
          data.type = this.prospectus_type
        }
        if (safeId === '309' || safeId === '280') {
          data.flag = this.prospectus_type
        }

        // 计算保额还是保费
        if (this.isBaseMoney) {
          data.base_money = this.insurance.money
        } else {
          data.year_fee = this.insurance.period_money
        }

        let mainPayYear = this.mainPayYear
        let py = mainPayYear === 1 ? 1 : mainPayYear - 1 // 主险缴费期间减一年
        let periodMoney = this.insurance.period_money
        let money = this.insurance.money
        // 险种参数
        if (safeId === '295') {
          // 恒祥
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = this.cache.base_money295
        } else if (safeId === '294') {
          // 恒顺
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = this.flag[safeId] > 50000 ? this.flag[safeId].toString().substr(1) : this.flag[safeId]
          data.flag = this.flag[safeId]
        } else if (safeId === '293') {
          // 尊享安康
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = 500000
        } else if (safeId === '289') {
          // 附加投保人豁免2017
          data.pay_year = py
          data.safe_year = py
          data.base_money = periodMoney
        } else if (safeId === '292') {
          data.base_money = money * 50000
        } else if (safeId === '285' || safeId === '284') {
          // 附加豁免保险费重大疾病保险 附加豁免保险费定期寿险
          data.pay_year = py
          data.safe_year = py
          data.base_money = periodMoney
        } else if (safeId === '281') {
          data.pay_year = mainPayYear
          data.safe_year = mainPayYear
          data.base_money = periodMoney
        } else if (safeId === '205') {
          data.flag = this.flag[safeId]
        } else if (safeId === '273') {
          data.pay_year = 1
          data.safe_year = 1
          data.flag = this.flag[safeId]
        } else if (safeId === '235' || safeId === '236' || safeId === '237') {
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = periodMoney
          data.flag = this.flag[safeId]
        } else if (safeId === '196') { // 附加住院津贴医疗保险
          data.pay_year = 1
          data.safe_year = 1
          if (periodMoney >= 1000 && periodMoney <= 3000) {
            data.base_money = 1
          } else if (periodMoney > 3000 && periodMoney <= 10000) {
            data.base_money = 2
          } else if (periodMoney > 10000 && periodMoney <= 20000) {
            data.base_money = 3
          } else if (periodMoney > 20000 && periodMoney <= 30000) {
            data.base_money = 5
          } else if (periodMoney > 30000 && periodMoney <= 50000) {
            data.base_money = 7
          } else if (periodMoney > 50000) {
            data.base_money = 10
          }
          data.year_fee = periodMoney
        } else if (safeId === '177') { // 附加御立方三号重大疾病保险-工银
          data.base_money = money
        } else if (safeId === '175') { // 附加乐无忧住院医疗保险
          data.pay_year = 1
          data.safe_year = 1
          data.flag = this.flag[safeId]
        } else if (safeId === '148') { // 附加综合意外伤害保险
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = this.cache.base_money148
          data.flag = this.flag[safeId]
        } else if (safeId === '147' || safeId === '146') {
          // 附加住院费用医疗保险  附加意外伤害医疗B
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = money
          data.year_fee = periodMoney
          data.flag = this.flag[safeId]
        } else if (safeId === '131') { // 附加乐相伴豁免保险费重大疾病保险
          data.pay_year = py
          data.safe_year = py
          data.year_fee = periodMoney
        } else if (safeId === '121') {
          data.pay_year = 1
          data.safe_year = 1
          data.base_money = 250000
        } else if (safeId === '94') {
          data.base_money = periodMoney * mainPayYear
          data.safe_year = 85
        } else if (safeId === '86') {
          data.pay_year = py
          data.safe_year = py
          data.base_money = periodMoney
        } else if (safeId === '11') {
          data.safe_year = 999
          data.pay_year = 1
          data.base_money = 0
        }

        if (!isAdd) { // 主险
          this.mainInsData = data
        } else {
          this.addonInsData[safeId] = data
        }
        utils.post('Prospectus/CreateBook3', qs.stringify({
          safes: JSON.stringify([data])
        })).then(ret => {
          if (ret.data.data &&
            ret.data.data[safeId] &&
            ret.data.data[safeId].main &&
            ret.data.data[safeId].main.list &&
            ret.data.data[safeId].main.list[1]) {
            if (!isAdd) { // 主险
              if (this.isBaseMoney) {
                this.insurance.period_money = ret.data.data[safeId].main.list[1]['年缴保费']
              } else {
                this.insurance.money = ret.data.data[safeId].base_money
              }
              this.checkMainFee(safeId)
            } else {
              this.addonRes[safeId] = ret.data.data[safeId].main.list[1]
              this.$forceUpdate()
            }
          } else {
            this.$toast.open('计算出错', 'error')
          }
        })
      },
      checkForm () {
        console.info('checkForm')
        let toastText = ''
        let safeId = this.insurance.safe_id
        let exp = /^(([1-9]\d{0,12})|0)(\.\d{1,2})?$/ // 保额

        if (!this.checkName(this.appl.name, '投保人')) {  // -------------------投保人
          return false
        } else if (!this.appl.age) {
          toastText = '投保人年龄不能为空'
        } else if (!this.checkName(this.assu.name, '被投保人')) { // -------------被投保人
          return false
        } else if (!this.assu.age) {
          toastText = '被投保人年龄不能为空'
        } else if (!this.sc_id) { // -----------------------------------------------险种
          toastText = '请选择公司品牌'
        } else if (!this.insurance.safe_id) {
          toastText = '请选择主险险种'
        } else if (!this.insurance.safe_year) {
          toastText = '请选择主险保险期间'
        } else if (!this.insurance.pay_year) {
          toastText = '请选择主险缴费年限'
        } else if (safeId === '205' && !this.flag[safeId]) {
          toastText = '请选择主险领取年龄'
        } else if (safeId === '352' && !this.flag[safeId]) {
          toastText = '请选择主险领取年龄'
        } else if (this.isBaseMoney && !this.insurance.money) {
          toastText = '请输入主险基本保额'
        } else if (this.isBaseMoney && !exp.test(this.insurance.money)) {
          toastText = '数字格式不规范，请重新输入'
        } else if (!this.isBaseMoney && !this.insurance.period_money) {
          toastText = '请输入主险年缴保费'
        } else if (this.prospectus_types.length > 0 && this.prospectus_type === 0) {
          toastText = '请选择主险计划类型'
        }

        if (toastText) {
          this.$toast.open(toastText)
          return false
        }
        return true
      },
      // 校验主险投保年龄
      checkMainAge (safeid) {
        console.info('checkMainAge, ID: ' + safeid)
        let assuAge = this.assu.age
        let mainPayYear = Number(this.mainPayYear)
        let mainSafeYear = Number(this.mainSafeYear)
        let payOverage = mainPayYear + assuAge // 缴费期满年龄

        let toastText = null
        switch (safeid) {
          case '360': // 恒大鑫福年
            if (assuAge > 54) {
              toastText = '被保人年龄不能大于54周岁'
            } else if (assuAge < 1) {
              toastText = '被保人年龄不能小于28天'
            }
            break
          case '352': // 附加品质生活年金保险
            if (mainPayYear === 1 && assuAge > 70 && this.flag[safeid] === 80) {
              toastText = '领取年龄为80岁且为1年交，被保人年龄不能大于70周岁'
            } else if (mainPayYear === 3 && assuAge > 67 && this.flag[safeid] === 80) {
              toastText = '领取年龄为80岁且为3年交，被保人年龄不能大于67周岁'
            } else if (mainPayYear === 5 && assuAge > 65 && this.flag[safeid] === 80) {
              toastText = '领取年龄为80岁且为5年交，被保人年龄不能大于65周岁'
            } else if (mainPayYear === 10 && assuAge > 60 && this.flag[safeid] === 80) {
              toastText = '领取年龄为80岁且为10年交，被保人年龄不能大于60周岁'
            } else if (mainPayYear === 1 && assuAge > 50 && this.flag[safeid] === 60) {
              toastText = '领取年龄为60岁且为1年交，被保人年龄不能大于50周岁'
            } else if (mainPayYear === 3 && assuAge > 47 && this.flag[safeid] === 60) {
              toastText = '领取年龄为60岁且为3年交，被保险人年龄不能大于47周岁'
            } else if (mainPayYear === 5 && assuAge > 45 && this.flag[safeid] === 60) {
              toastText = '领取年龄为60岁且为5年交，被保险人年龄不能大于45周岁'
            } else if (mainPayYear === 10 && assuAge > 40 && this.flag[safeid] === 60) {
              toastText = '领取年龄为60岁且为10年交，被保险人年龄不能大于40周岁'
            }
            break
          case '348': // 泰康乐赢家
            if (mainPayYear === 1 && assuAge > 63) {
              toastText = '被保人年龄不能大于63周岁'
            } else if (mainPayYear === 3 && assuAge > 60) {
              toastText = '3年交被保人年龄不能大于60周岁'
            } else if (mainPayYear === 5 && assuAge > 60) {
              toastText = '5年交被保人年龄不能大于60周岁'
            } else if (mainPayYear === 10 && assuAge > 55) {
              toastText = '10年交被保人年龄不能大于55周岁'
            } else if (mainPayYear === 15 && assuAge > 54) {
              toastText = '20年交被保人年龄不能大于54周岁'
            } else if (mainPayYear === 20 && assuAge > 50) {
              toastText = '30年交被保人年龄不能大于35周岁'
            }
            break
          case '316': // 华宝安行
            if (assuAge > 50) {
              toastText = '被保人年龄不能大于50周岁'
            } else if (assuAge < 18) {
              toastText = '被保人年龄不能小于18周岁'
            }
            break
          case '313': // 爱驾宝两全保险(2017)
            if (assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            } else if (assuAge < 18) {
              toastText = '被保人年龄不能小于18周岁'
            } else if (assuAge > 50 && mainSafeYear === 30) {
              toastText = '被保人大于50周岁时,只能选择20年交'
            }
            break
          case '292': // 千万护航两全保险
            if (assuAge < 18 || assuAge > 55) {
              toastText = '被保人年龄范围应在18-55周岁'
            }
            break
          case '290': // 金财人生终身年金保险D款
            if (mainPayYear === 1 && assuAge > 59) {
              toastText = '趸交投保年龄上限为59岁'
            } else if ([3, 5].indexOf(mainPayYear) > -1 && assuAge > 55) {
              toastText = mainPayYear + '年交投保年龄上限为55岁'
            } else if (mainPayYear === 10 && assuAge > 50) {
              toastText = '10年交投保年龄上限为50岁'
            }
            break
          case '288': // 恒久健康终身重大疾病保险2017
            if ([1, 3, 5, 10].indexOf(mainPayYear) > -1 && assuAge > 65) {
              toastText = (mainPayYear === 1 ? '趸交' : mainPayYear + '年交') + '投保年龄上限为65岁'
            } else if (mainPayYear === 15 && assuAge > 60) {
              toastText = '15年交投保年龄上限为60岁'
            } else if (mainPayYear === 20 && assuAge > 55) {
              toastText = '20年交投保年龄上限为55岁'
            }
            break
          case '283': // 御享人生重大疾病保险
            if (mainPayYear === 5 && assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            } else if (mainPayYear === 10 && assuAge > 55) {
              toastText = '被保人年龄不能大于55周岁'
            } else if (mainPayYear === 15 && assuAge > 50) {
              toastText = '被保人年龄不能大于50周岁'
            } else if (mainPayYear === 20 && assuAge > 50) {
              toastText = '被保人年龄不能大于50周岁'
            } else if (mainPayYear === 30 && assuAge > 35) {
              toastText = '被保人年龄不能大于35周岁'
            }
            break
          case '280': // 平安e生保
            if (assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '272': // 盛世年年C款年金保险
            if (assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '209': // 信泰人寿：健康100
            if (assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '210': // 信泰人寿：健康100(铂金版)
            if (assuAge > 50) {
              toastText = '被保人年龄不能大于50周岁'
            }
            break
          case '205': // 尊享岁月
            if (assuAge > 65) {
              toastText = '被保人年龄不能大于65周岁'
            } else if (payOverage > this.flag[safeid]) {
              toastText = '交费期满被保人年龄不能超过开始领取年龄'
            }
            break
          case '172': // 鑫丰年年
            if (mainPayYear === 1 && assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            } else if (mainPayYear === 3 && assuAge > 60) {
              toastText = '3年交被保人年龄不能大于60周岁'
            } else if (mainPayYear === 5 && assuAge > 55) {
              toastText = '5年交被保人年龄不能大于55周岁'
            } else if (mainPayYear === 10 && assuAge > 50) {
              toastText = '10年交被保人年龄不能大于50周岁'
            }
            break
          case '319': // 爱加倍
          case '165': // 爱相随-尊享版
            if (assuAge > 50 && mainPayYear > 10) {
              toastText = '被保人年龄不能大于50周岁'
            } else if (assuAge > 55 && mainPayYear === 10) {
              toastText = '被保人年龄不能大于55周岁'
            } else if (assuAge > 60 && mainPayYear < 10) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '130': // 乐安康
            if (assuAge > 50 && mainPayYear > 10) {
              toastText = '被保人年龄不能大于50周岁'
            } else if (assuAge > 55 && mainPayYear === 10) {
              toastText = '被保人年龄不能大于55周岁'
            } else if (assuAge > 60 && mainPayYear < 10) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '74': // 盛世年年
            if (payOverage > 60) {
              toastText = '被保人交费期满不能大于60岁'
            }
            break
          case '86':
            if (assuAge > 55) {
              toastText = '被保人年龄不能大于55周岁'
            }
            break
          case '8': // 御立方三号两全保险
            if (mainSafeYear === 66) {
              if (mainPayYear === 3 && assuAge > 50) {
                toastText = '3年交保障至66周岁时被保人年龄不能大于50周岁'
              } else if (mainPayYear === 5 && assuAge > 50) {
                toastText = '5年交保障至66周岁时被保人年龄不能大于50周岁'
              } else if (mainPayYear === 10 && assuAge > 45) {
                toastText = '10年交保障至66周岁时被保人年龄不能大于45周岁'
              } else if (mainPayYear === 20 && assuAge > 40) {
                toastText = '20年交保障至66周岁时被保人年龄不能大于40周岁'
              } else if (mainPayYear === 30 && assuAge > 30) {
                toastText = '30年交保障至66周岁时被保人年龄不能大于30周岁'
              }
            } else if (mainSafeYear === 77) {
              if (mainPayYear === 3 && assuAge > 55) {
                toastText = '3年交保障至77周岁被保人年龄不能大于55周岁'
              } else if (mainPayYear === 5 && assuAge > 55) {
                toastText = '5年交保障至77周岁被保人年龄不能大于55周岁'
              } else if (mainPayYear === 10 && assuAge > 50) {
                toastText = '10年交保障至77周岁被保人年龄不能大于50周岁'
              } else if (mainPayYear === 20 && assuAge > 45) {
                toastText = '20年交保障至77周岁被保人年龄不能大于45周岁'
              } else if (mainPayYear === 30 && assuAge > 35) {
                toastText = '30年交保障至77周岁被保人年龄不能大于35周岁'
              }
            } else if (mainSafeYear === 88) {
              if (mainPayYear === 3 && assuAge > 60) {
                toastText = '3年交保障至88周岁时被保人年龄不能大于60周岁'
              } else if (mainPayYear === 5 && assuAge > 60) {
                toastText = '5年交保障至88周岁时被保人年龄不能大于60周岁'
              } else if (mainPayYear === 10 && assuAge > 55) {
                toastText = '10年交保障至88周岁时被保人年龄不能大于55周岁'
              } else if (mainPayYear === 20 && assuAge > 45) {
                toastText = '20年交保障至88周岁时被保人年龄不能大于45周岁'
              } else if (mainPayYear === 30 && assuAge > 35) {
                toastText = '30年交保障至88周岁时被保人年龄不能大于35周岁'
              }
            }
            break
        }

        if (toastText) {
          this.$toast.open('【' + this.insurance.name + '】' + toastText)
          return false
        }
        return true
      },
      // 主险保额校验
      checkMainMoney (safeid) {
        console.info('checkMainMoney, ID: ' + safeid)
        let money = this.insurance.money
        let periodMoney = this.insurance.period_money
        let mainPayYear = this.mainSafeYear
        let assuAge = this.assu.age
        let name = this.mainInsurance.name
        let toastText = null

        switch (safeid) {
          case '348': // 泰康乐赢家
            if (money < 200000 || money % 10000 !== 0) {
              toastText = '【' + name + '】最低保额20万元，且为1万元整数倍！'
            }
            break
          case '319': // 爱加倍
            if (mainPayYear === '19') {
              if (money < 100000 || money % 10000 !== 0) {
                toastText = '【' + name + '】19年交最低保额10万元，且为1万元整数倍！'
              }
            } else if (money < 20000 || money % 10000 !== 0) {
              toastText = '【' + name + '】保额最低2万元，且为1万元整数倍'
            }
            break
          case '316': // 华宝安行
            if (money < 50000 || money % 50000 !== 0) {
              toastText = '【' + name + '】最低保额为5万元，且为5万元整数倍'
            } else if (money > 200000) {
              toastText = '【' + name + '】最高保额为20万元'
            }
            break
          case '314': // 百万终身护理保险
            if (money < 3000 || money % 1000 !== 0) {
              toastText = '【' + name + '】保额最低3千元，且为千元整数倍'
            } else if (money > 500000) {
              toastText = '【' + name + '】保额最高为50万元'
            }
            break
          case '313': // 爱驾宝两全保险(2017)
            if (money < 10000 || money % 10000 !== 0) {
              toastText = '【' + name + '】保额最低1万元，且为1万元整数倍'
            }
            break
          case '292': // 千万护航两全保险
            if (!money) {
              toastText = '【' + name + '】50000元/份，1份起售'
            }
            break
          case '290': // 金财人生终身年金保险D款
            if (periodMoney < 10000) {
              toastText = '【' + name + '】最低年缴保费为1万元'
            } else if (periodMoney % 1000 !== 0) {
              toastText = '【' + name + '】保费需为1千元整数倍'
            }
            break
          case '288': // 恒久健康终身重大疾病保险2017
            if (money < 10000 || money % 1000 !== 0) {
              toastText = '最低保额为1万元,且为1千元整数倍'
            }
            break
          case '283': // 御享人生重大疾病保险
            if (money < 50000) {
              toastText = '【' + name + '】最低保额为5万元'
            }
            break
          case '272': // 盛世年年C款年金保险
            if (money < 150000 || money % 10000 !== 0) {
              toastText = '【' + name + '】最低保额为15万元，且为1万元整数倍'
            }
            break
          case '209': // 信泰人寿：健康100
            if (money < 50000 || money % 10000 !== 0) {
              toastText = '该主险最低保额为5万元，且为1万元整数倍'
            }
            break
          case '210': // 信泰人寿：健康100(铂金版)
            if (money < 300000 || money % 10000 !== 0) {
              toastText = '该主险最低保额为30万元，且为1万元整数倍'
            }
            break
          case '205': // 泰康：尊享岁月分红型
            if (money % 1000 !== 0) {
              toastText = '该主险保额应为1000元的整数倍'
            }
            break
          case '172': // 工银： 鑫丰年年
            if (mainPayYear === '1') {
              if (money < 3000) {
                toastText = '趸交的最低保额为3000元！'
              }
            } else if (money < 2000) {
              toastText = '最低保额为2000元！'
            }
            break
          case '165': // 爱相随-尊享版
            if (assuAge >= 18 && money > 1000000) {
              toastText = '【' + name + '】成年人最高保额为100万元'
            } else if (assuAge < 18 && money > 500000) {
              toastText = '【' + name + '】未成年人最高保额为50万元'
            } else if (mainPayYear === '19') {
              if (money < 300000 || money % 10000 !== 0) {
                toastText = '【' + name + '】19年交最低保额30万元，且为1万元整数倍！'
              }
            } else if (money < 50000 || money % 10000 !== 0) {
              toastText = '【' + name + '】保额最低5万元，且为1万元整数倍'
            }
            break
          case '130': // 乐安康
            if (money < 50000 || money % 10000 !== 0) {
              toastText = '该主险最低保额为5万元，且为1万元整数倍！'
            }
            break
          case '74': // 盛世年年
            if (mainPayYear === '1') {
              if (periodMoney < 10000 || periodMoney % 1000 !== 0) {
                toastText = '趸交的最低保费为1万元,且以千元递增！'
              }
            } else if (periodMoney < 5000 || periodMoney % 1000 !== 0) {
              toastText = '最低年缴保费为5千元,且以千元递增'
            }
            break
          case '8': // 御立方三号两全保险
            if (money < 10000) {
              toastText = '该主险最低保额为1万元'
            }
            break
        }
        if (toastText) {
          this.$toast.open(toastText)
          return false
        }
        return true
      },
      // 主险保费校验
      checkMainFee (safeid) {
        console.info('checkMainFee, ID: ' + safeid)
        let toastText = null
        let periodMoney = this.insurance.period_money
        let mainSafeYear = this.mainSafeYear
        let money = this.insurance.money

        if (this.isBaseMoney && !periodMoney) {
          toastText = periodMoney === 0 ? '超出费率表计算范围' : '请计算主险年缴保费'
        } else if (!this.isBaseMoney && !money) {
          toastText = money === 0 ? '超出费率表计算范围' : '请计算主险基本保额'
        }
        if (toastText) {
          this.$toast.open(toastText)
          return false
        }

        switch (safeid) {
          case '360': // 恒大鑫福年
            if (money < 1000) {
              toastText = '该主险最低保额1千元！'
            }
            break
          case '8': // 御立方三号两全保险
            if (periodMoney < 1000) {
              toastText = '该主险最低年缴保费为1000元'
            }
            break
          case '283': // 御享人生重大疾病保险
            if (periodMoney < 1000) {
              toastText = '该主险最低年缴保费为1000元'
            }
            break
          case '205': // 尊享岁月养老年金保险（分红型）
            if (mainSafeYear === '15' || mainSafeYear === '20') {
              if (periodMoney < 150000) {
                toastText = '【' + name + '】15、20最低年交保费15万元'
              }
            } else {
              if (periodMoney < 200000) {
                toastText = '该交费期间最低年交保费20万元'
              }
            }
            break
        }
        if (toastText) {
          this.$toast.open(toastText)
          setTimeout(() => {
            this.insurance.period_money = ''
          }, 2000)
          return false
        }
        return true
      },
      // 校验附加险投保年龄
      checkExtraAge (safeid) {
        console.info('checkExtraAge, ID: ' + safeid)
        let assuAge = this.assu.age
        let applAge = this.appl.age
        let payOverage = Number(this.insurance.pay_year) - 1 + applAge // 期满年龄
        let toastText = null

        switch (safeid) {
          case '121':
            if (assuAge > 55) {
              toastText = '被保人年龄不能大于55周岁'
            }
            break
          case '131':
            if (applAge > 69) {
              toastText = '被豁免合同投保人年龄不能大于69周岁'
            }
            break
          case '148':
            if (assuAge > 70) {
              toastText = '被保人年龄不能大于70周岁'
            }
            break
          case '146':
          case '147':
          case '175':
          case '196':
          case '281':
            if (applAge > 68) {
              toastText = '被豁免合同投保人年龄不能大于68周岁'
            }
            break
          case '235':
          case '236':
          case '237':
          case '273':
            if (assuAge > 60) {
              toastText = '被保人年龄不能大于60周岁'
            }
            break
          case '285':
            if (applAge > 60 || payOverage > 75) {
              toastText = '投保人年龄不能大于60周岁,且期满年龄不能大于75岁'
            }
            break
          case '293': // 尊享安康
            if (assuAge > 65) {
              toastText = '被保人年龄不能大于65周岁'
            }
            break
          case '294': // 恒顺
            if (assuAge > 65) {
              toastText = '被保人年龄不能大于65周岁'
            }
            break
          case '295': // 恒祥
            if (assuAge > 65) {
              toastText = '被保人年龄不能大于65周岁'
            }
            break
        }

        if (toastText) {
          this.$toast.open(toastText)
          return false
        }
        return true
      },
      // 更改附加险状态
      chAddonState (safeid) {
        console.info('chAddonState 附加险ID：' + safeid)
        if (this.uploading) {
          this.addonsSelected[safeid] = !this.addonsSelected[safeid]
          this.$forceUpdate()
          return false
        }

        this.checkRS()
        let toastText = null
        if (this.addonsSelected[safeid]) {
          // 主险保费校验不合格
          if (!this.checkMainFee(this.insurance.safe_id)) {
            this.addonsSelected[safeid] = false
            this.$forceUpdate()
            return false
          }
          let flag = this.flag[safeid]
          let periodMoney = this.insurance.period_money
          let mainPayYear = this.mainSafeYear

          switch (this.insurance.safe_id) {
            case '288':
              if (['295', '294', '293'].indexOf(safeid) > -1) {
                if (this.insurance.money < 250000) {
                  toastText = '主险保额小于25万元时不可附加该险种'
                }
              }
              break
            case '290':
              if (['295', '294', '293'].indexOf(safeid) > -1) {
                if (this.insurance.pay_year === 10 && this.insurance.period_money < 10000) {
                  toastText = '主险缴费期为 10年，且期交保费 1 万及以上方可附加'
                } else if (this.insurance.period_money < 20000 && [3, 5].indexOf(this.insurance.pay_year) === -1) {
                  toastText = '主险缴费期为 3 年、5 年，且期交保费 2 万及以上方可附加'
                }
              }
              break
            case '292':
              if (['295', '294', '293'].indexOf(safeid) > -1) {
                if (this.insurance.money * 50000 < 200000) {
                  toastText = '主险保额小于20万元时不可附加该险种'
                }
              }
              break
            default:
              break
          }

          switch (safeid) {
            case '354': // 附加品质生活年金-中国人保
              if (toastText) break
              if (this.cache.derate_money354 === '') {
                toastText = '年缴保费不能为空'
              } else if (this.cache.derate_money354 !== 0 && this.cache.derate_money354 % 1000 !== 0) {
                toastText = '年缴保费为1000元整数倍，可为0'
              } else if (this.cache.derate_money354 > this.insurance.period_money * mainPayYear) {
                toastText = '该附加险保费不能超过主险总保费'
              }
              break
            case '349': // 附加金账户年金-工银
              if (toastText) break
              if (this.cache.derate_money349 === '') {
                toastText = '年缴保费不能为空'
              } else if ((this.cache.derate_money349 !== 0) && (this.cache.derate_money349 % 1000 !== 0)) {
                toastText = '年缴保费为1000元整数倍，可为0'
              } else if (this.cache.derate_money349 > this.insurance.period_money * mainPayYear) {
                toastText = '该附加险保费不能超过主险总保费'
              }
              break
            case '332': // 乐行天下
              if (toastText) break
              if (flag === 0) {
                toastText = '请先选择保险金额'
              }
              break
            case '295': // 恒祥
              if (toastText) break
              if (!this.cache.base_money295) {
                toastText = '请先输入保险金额'
              } else if (this.cache.base_money295 < 50 || this.cache.base_money295 > 100 || this.cache.base_money295 % 10 !== 0) {
                toastText = '保险金额范围50-100元，且为10的整数'
              }
              break
            case '294': // 恒顺
              if (toastText) break
              let extraMoney = flag > 50000 ? flag.toString().substr(1) : flag
              if (!flag) {
                toastText = '请先选择保险金额'
              } else if (extraMoney > this.insurance.period_money * mainPayYear * 0.2 && this.insurance.safe_id === '290') {
                // 主险--金财D
                toastText = '该附加险保额不超主合同总保费（期交保费*缴费年限）*20%'
              } else if (extraMoney > this.insurance.money * 0.2 && this.insurance.safe_id === '288') {
                // 恒久健康
                toastText = '该附加险保额不能大于主险保额的20%'
              } else if (extraMoney > this.insurance.money * 50000 * 0.2 && this.insurance.safe_id === '292') {
                // 千万护航
                toastText = '该附加险保额不能大于主险保额的20%'
              }
              break
            case '293': // 恒顺
              if (!flag) {
                toastText = '请先选择保险金额'
              }
              break
            case '291': // 金管家D款
              if (toastText) break
              if (this.cache.derate_money291 === '') {
                toastText = '年缴保费不能为空'
              } else if (this.cache.derate_money291 !== 0 && this.cache.derate_money291 % 1000 !== 0) {
                toastText = '年缴保费为1000元整数倍，可为0'
              } else if (this.cache.derate_money291 > this.insurance.period_money * mainPayYear) {
                toastText = '该附加险保费不能超过主险总保费'
              }
              break
            case '281':
              if (this.samePerson) {
                toastText = '投被保人为同人时不可附加该险种'
              } else if (mainPayYear === 1) {
                toastText = '主险趸交不可附加该险种'
              }
              break
            case '196':
              if (periodMoney < 1000) {
                toastText = '主险年交保费小于1000元不可附加该险种'
              }
              break
            case '273':
            case '175':
              if (flag === 0) {
                toastText = '请先选择计划'
              }
              break
            case '148':
              if (!this.cache.base_money148) {
                toastText = '请先输入保险金额'
              } else if (this.cache.base_money148 < 50000 || this.cache.base_money148 > 3000000) {
                toastText = '保险金额范围为5万~300万'
              } else if (this.cache.base_money148 > this.insurance.money * 5) {
                toastText = '保额不得超过主险保额的5倍'
              } else if (flag === 0) {
                toastText = '请先选择职业分类'
              }
              break
            case '147':
              if (periodMoney < 1000) {
                toastText = '主险年交保费小于1000元不可附加该险种'
              } else if (periodMoney <= 3000 && (this.cache.quota147 < 2 || this.cache.quota147 > 10)) {
                toastText = '主险保费对应份额为2-10份'
              } else if (this.cache.quota147 < 2 || this.cache.quota147 > 30) {
                toastText = '主险保费对应份额为2-30份'
              }
              break
            case '146':
              if (flag === 0) {
                toastText = '请先选择保险金额'
              }
              break
            case '131':
              if (periodMoney === '') {
                toastText = '请先完善其他附加险，算出主险年缴保费'
              }
              if (this.samePerson) {
                toastText = '投被保人为同人时不可附加该险种'
              }
              if (this.insurance.pay_year === '1') {
                toastText = '缴费期间为趸交不可附加该险种'
              }
              break
            case '86': // 附加豁免保险费重疾保险
            case '289':
            case '285': // 附加豁免保险费重大疾病保险
            case '284': // 附加豁免保险费定期寿险
              if (this.samePerson) {
                toastText = '投被保人为同人时不可附加该险种'
              }
              break
            case '121':
              if (periodMoney < 3000) {
                toastText = '主险年交保费小于3000元不可附加该险种'
              }
              break
            case '235': // 附加住院费用医疗（非社保型）
              if (this.addonsSelected[236]) {
                toastText = '社保与非社保只能选择一个'
              } else if (flag === 0) {
                toastText = '请先选择保险金额'
              }
              break

            case '236': // 附加住院费用医疗（社保型）
              if (this.addonsSelected[235]) {
                toastText = '社保与非社保只能选择一个'
              } else if (flag === 0) {
                toastText = '请先选择保险金额'
              }
              break
            case '237': // 附加住院费用医疗（社保型）
              if (flag === 0) {
                toastText = '请先选择保险金额'
              }
              break
          }
          if (toastText) {
            this.$toast.open(toastText)
            this.addonsSelected[safeid] = false
            this.$forceUpdate()
          } else {
            this.calMoney(safeid)// 试算附加险
          }
        } else {
          if (mustSelected.indexOf(safeid) > -1) {
            toastText = '该附加险必须附加，不能取消'
            this.$toast.open(toastText)
            this.addonsSelected[safeid] = true
            this.$forceUpdate()
            this.calMoney(safeid)// 试算附加险
          }
        }
      },
      // 重置附加险默认信息
      resetAddon () {
        console.info('resetAddon')
        // this.log('重置附加险默认信息', INFO)
        let safeid = this.insurance.safe_id
        if (safeid === '318') {
          this.flag[332] = 0
        } else if (safeid === '288' || safeid === '290' || safeid === '292') {
          this.flag[294] = 0
          this.flag[293] = 0
        } else if (safeid === '283') {
          this.flag[146] = 0
          this.flag[147] = 2000
          this.cache.quota147 = 2
          this.flag[148] = 0
          this.cache.base_money148 = 0
        } else if (safeid === '272') {
          this.flag[273] = 0
        } else if (safeid === '130') {
          this.flag[175] = 1
        } else if (safeid === '165' || safeid === '319') {
          this.flag[235] = 0
          this.flag[236] = 0
          this.flag[237] = 0
        }
        this.addonsSelected = {}
        this.cache.pay_money332 = ''
        this.cache.pay_money333 = ''
        for (let i in this.Addons) {
          const j = this.Addons[i].safe_id
          this.addonsSelected[j] = false
          if (mustSelected.indexOf(j) > -1) {
            // this.addonsSelected[j] = true
          }
        }
        this.addonRes = {}
      },
      // 校验关系
      checkRS () {
        console.info('checkRS')
        if (this.appl.name === this.assu.name && this.appl.sex === this.assu.sex && this.appl.age === this.assu.age) {
          // 3要素相同
          this.samePerson = true
          console.log('被保险人和投保人为同一人')
        } else {
          this.samePerson = false
        }
      },
      // 更新附加险Flag
      flagChanged (index) {
        console.info('flagChanged')
        this.addonRes[index] = null
        this.addonsSelected[index] = false
        if (index === '147') {
          if (this.cache.quota147 < 2 || this.cache.quota147 > 30) {
//            this.$toast.open()
          }
          this.flag[index] = this.cache.quota147 * 1000
        }
        this.$forceUpdate()
      },
      saveIns () {
        console.info('saveIns')
        this.ins[this.index] = {
          main: this.mainInsData,
          insurance: this.insurance,
          addon: this.addonInsData
        }
        this.$store.commit('SET_PLAN', this.ins)
      }
    },
    created () {
      if (this.edit) {
        let safeId = this.edit.main.safe_id
        this.sc_id = utils.getCompanyId(this.insList.main, safeId)
        this.companyChanged()
      }
    }
  }
</script>
